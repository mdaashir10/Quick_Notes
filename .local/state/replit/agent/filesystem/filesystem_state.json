{"file_contents":{"src/main/java/com/notes/servlets/ListNotesServlet.java":{"content":"package com.notes.servlets;\n\nimport java.io.File;\nimport java.io.IOException;\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.List;\nimport javax.servlet.ServletException;\nimport javax.servlet.annotation.WebServlet;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\n\n/**\n * ListNotesServlet - Handles listing all note files for the public page.\n * \n * This servlet reads the notes directory and passes the list of files\n * to the index.jsp for display. No authentication required.\n * \n * @author Admin\n */\n@WebServlet(\"/list\")\npublic class ListNotesServlet extends HttpServlet {\n    \n    // Directory where notes are stored\n    private static final String NOTES_DIR = System.getProperty(\"user.dir\") + \"/notes\";\n    \n    @Override\n    protected void doGet(HttpServletRequest request, HttpServletResponse response) \n            throws ServletException, IOException {\n        \n        // Create the notes directory if it doesn't exist\n        File notesFolder = new File(NOTES_DIR);\n        if (!notesFolder.exists()) {\n            notesFolder.mkdirs();\n        }\n        \n        // Get list of all files in the notes directory\n        List<String> noteFiles = new ArrayList<>();\n        File[] files = notesFolder.listFiles();\n        \n        if (files != null) {\n            // Sort files by name for consistent display\n            Arrays.sort(files, (f1, f2) -> f1.getName().compareToIgnoreCase(f2.getName()));\n            \n            for (File file : files) {\n                // Only include regular files, not directories or hidden files\n                if (file.isFile() && !file.getName().startsWith(\".\")) {\n                    noteFiles.add(file.getName());\n                }\n            }\n        }\n        \n        // Store the file list in request attribute for JSP to access\n        request.setAttribute(\"noteFiles\", noteFiles);\n        request.setAttribute(\"notesDir\", NOTES_DIR);\n        \n        // Forward to index.jsp for display\n        request.getRequestDispatcher(\"/index.jsp\").forward(request, response);\n    }\n}\n","path":null,"size_bytes":2137,"size_tokens":null},"src/main/java/com/notes/servlets/UploadServlet.java":{"content":"package com.notes.servlets;\n\nimport java.io.File;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.nio.file.Files;\nimport java.nio.file.Path;\nimport java.nio.file.Paths;\nimport java.nio.file.StandardCopyOption;\nimport javax.servlet.ServletException;\nimport javax.servlet.annotation.MultipartConfig;\nimport javax.servlet.annotation.WebServlet;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport javax.servlet.http.Part;\n\n/**\n * UploadServlet - Handles file uploads for admin users.\n * \n * This servlet processes multipart form data to upload note files.\n * Only accessible by authenticated admin users.\n * \n * @MultipartConfig enables multipart/form-data handling for file uploads.\n * \n * @author Admin\n */\n@WebServlet(\"/admin/upload\")\n@MultipartConfig(\n    fileSizeThreshold = 1024 * 1024,      // 1 MB - files larger than this are written to disk\n    maxFileSize = 1024 * 1024 * 10,       // 10 MB - maximum size per file\n    maxRequestSize = 1024 * 1024 * 50     // 50 MB - maximum total request size\n)\npublic class UploadServlet extends HttpServlet {\n    \n    // Directory where notes are stored\n    private static final String NOTES_DIR = System.getProperty(\"user.dir\") + \"/notes\";\n    \n    @Override\n    protected void doPost(HttpServletRequest request, HttpServletResponse response) \n            throws ServletException, IOException {\n        \n        // Ensure the notes directory exists\n        File notesFolder = new File(NOTES_DIR);\n        if (!notesFolder.exists()) {\n            notesFolder.mkdirs();\n        }\n        \n        // Get the uploaded file part from the request\n        Part filePart = request.getPart(\"noteFile\");\n        \n        if (filePart == null || filePart.getSize() == 0) {\n            // No file was uploaded\n            request.setAttribute(\"message\", \"Error: Please select a file to upload.\");\n            request.setAttribute(\"messageType\", \"error\");\n            request.getRequestDispatcher(\"/admin/dashboard\").forward(request, response);\n            return;\n        }\n        \n        // Extract the original filename from the Part\n        String fileName = extractFileName(filePart);\n        \n        if (fileName == null || fileName.isEmpty()) {\n            request.setAttribute(\"message\", \"Error: Invalid file name.\");\n            request.setAttribute(\"messageType\", \"error\");\n            request.getRequestDispatcher(\"/admin/dashboard\").forward(request, response);\n            return;\n        }\n        \n        // Sanitize the filename to prevent directory traversal attacks\n        fileName = sanitizeFileName(fileName);\n        \n        // Create the target path for the file\n        Path targetPath = Paths.get(NOTES_DIR, fileName);\n        \n        // Check if file already exists\n        if (Files.exists(targetPath)) {\n            request.setAttribute(\"message\", \"Error: A file with this name already exists. Please rename your file.\");\n            request.setAttribute(\"messageType\", \"error\");\n            request.getRequestDispatcher(\"/admin/dashboard\").forward(request, response);\n            return;\n        }\n        \n        // Save the uploaded file\n        try (InputStream fileContent = filePart.getInputStream()) {\n            Files.copy(fileContent, targetPath, StandardCopyOption.REPLACE_EXISTING);\n        }\n        \n        // Set success message and redirect to admin dashboard\n        request.setAttribute(\"message\", \"Success: File '\" + fileName + \"' uploaded successfully!\");\n        request.setAttribute(\"messageType\", \"success\");\n        request.getRequestDispatcher(\"/admin/dashboard\").forward(request, response);\n    }\n    \n    /**\n     * Extracts the filename from the Content-Disposition header of a Part.\n     * \n     * @param part The file Part from the multipart request\n     * @return The extracted filename, or null if not found\n     */\n    private String extractFileName(Part part) {\n        String contentDisposition = part.getHeader(\"content-disposition\");\n        \n        if (contentDisposition != null) {\n            // Parse the Content-Disposition header to find filename\n            for (String token : contentDisposition.split(\";\")) {\n                if (token.trim().startsWith(\"filename\")) {\n                    // Extract the filename value\n                    String fileName = token.substring(token.indexOf('=') + 1).trim();\n                    // Remove surrounding quotes if present\n                    fileName = fileName.replace(\"\\\"\", \"\");\n                    // Handle browsers that send full path (IE)\n                    int lastSeparator = Math.max(fileName.lastIndexOf('/'), fileName.lastIndexOf('\\\\'));\n                    if (lastSeparator >= 0) {\n                        fileName = fileName.substring(lastSeparator + 1);\n                    }\n                    return fileName;\n                }\n            }\n        }\n        return null;\n    }\n    \n    /**\n     * Sanitizes the filename to prevent security issues.\n     * Removes potentially dangerous characters and path components.\n     * \n     * @param fileName The original filename\n     * @return A sanitized, safe filename\n     */\n    private String sanitizeFileName(String fileName) {\n        // Remove any path separators to prevent directory traversal\n        fileName = fileName.replaceAll(\"[/\\\\\\\\]\", \"\");\n        // Remove any null bytes\n        fileName = fileName.replace(\"\\0\", \"\");\n        // Replace multiple dots with single dot\n        fileName = fileName.replaceAll(\"\\\\.{2,}\", \".\");\n        // Remove leading dots\n        while (fileName.startsWith(\".\")) {\n            fileName = fileName.substring(1);\n        }\n        return fileName;\n    }\n}\n","path":null,"size_bytes":5733,"size_tokens":null},"src/main/java/com/notes/servlets/DeleteServlet.java":{"content":"package com.notes.servlets;\n\nimport java.io.File;\nimport java.io.IOException;\nimport java.nio.file.Files;\nimport java.nio.file.Path;\nimport java.nio.file.Paths;\nimport javax.servlet.ServletException;\nimport javax.servlet.annotation.WebServlet;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\n\n/**\n * DeleteServlet - Handles file deletion for admin users.\n * \n * This servlet deletes note files from the notes directory.\n * Only accessible by authenticated admin users.\n * \n * @author Admin\n */\n@WebServlet(\"/admin/delete\")\npublic class DeleteServlet extends HttpServlet {\n    \n    // Directory where notes are stored\n    private static final String NOTES_DIR = System.getProperty(\"user.dir\") + \"/notes\";\n    \n    @Override\n    protected void doPost(HttpServletRequest request, HttpServletResponse response) \n            throws ServletException, IOException {\n        \n        // Get the filename to delete from the request\n        String fileName = request.getParameter(\"fileName\");\n        \n        if (fileName == null || fileName.trim().isEmpty()) {\n            // No filename provided\n            request.setAttribute(\"message\", \"Error: No file specified for deletion.\");\n            request.setAttribute(\"messageType\", \"error\");\n            request.getRequestDispatcher(\"/admin/dashboard\").forward(request, response);\n            return;\n        }\n        \n        // Sanitize the filename to prevent directory traversal attacks\n        fileName = sanitizeFileName(fileName);\n        \n        // Create path to the file\n        Path filePath = Paths.get(NOTES_DIR, fileName);\n        File fileToDelete = filePath.toFile();\n        \n        // Security check: ensure the file is within the notes directory\n        if (!fileToDelete.getCanonicalPath().startsWith(new File(NOTES_DIR).getCanonicalPath())) {\n            request.setAttribute(\"message\", \"Error: Invalid file path.\");\n            request.setAttribute(\"messageType\", \"error\");\n            request.getRequestDispatcher(\"/admin/dashboard\").forward(request, response);\n            return;\n        }\n        \n        // Check if file exists\n        if (!fileToDelete.exists()) {\n            request.setAttribute(\"message\", \"Error: File '\" + fileName + \"' does not exist.\");\n            request.setAttribute(\"messageType\", \"error\");\n            request.getRequestDispatcher(\"/admin/dashboard\").forward(request, response);\n            return;\n        }\n        \n        // Check if it's actually a file (not a directory)\n        if (!fileToDelete.isFile()) {\n            request.setAttribute(\"message\", \"Error: Cannot delete directories.\");\n            request.setAttribute(\"messageType\", \"error\");\n            request.getRequestDispatcher(\"/admin/dashboard\").forward(request, response);\n            return;\n        }\n        \n        // Attempt to delete the file\n        try {\n            Files.delete(filePath);\n            request.setAttribute(\"message\", \"Success: File '\" + fileName + \"' deleted successfully!\");\n            request.setAttribute(\"messageType\", \"success\");\n        } catch (IOException e) {\n            request.setAttribute(\"message\", \"Error: Could not delete file. \" + e.getMessage());\n            request.setAttribute(\"messageType\", \"error\");\n        }\n        \n        // Forward to admin dashboard\n        request.getRequestDispatcher(\"/admin/dashboard\").forward(request, response);\n    }\n    \n    /**\n     * Sanitizes the filename to prevent security issues.\n     * Removes potentially dangerous characters and path components.\n     * \n     * @param fileName The original filename\n     * @return A sanitized, safe filename\n     */\n    private String sanitizeFileName(String fileName) {\n        // Remove any path separators to prevent directory traversal\n        fileName = fileName.replaceAll(\"[/\\\\\\\\]\", \"\");\n        // Remove any null bytes\n        fileName = fileName.replace(\"\\0\", \"\");\n        return fileName;\n    }\n}\n","path":null,"size_bytes":3991,"size_tokens":null},"run.sh":{"content":"#!/bin/bash\n\n# ================================================\n# Student Notes Application - Run Script\n# ================================================\n# This script builds the application with Maven\n# and deploys it to Tomcat.\n# ================================================\n\nset -e\n\n# Configuration\nTOMCAT_HOME=\"/home/runner/tomcat\"\nPROJECT_DIR=\"/home/runner/${REPL_SLUG}\"\nNOTES_DIR=\"${PROJECT_DIR}/notes\"\n\necho \"==============================================\"\necho \"  Student Notes Application - Starting...\"\necho \"==============================================\"\n\n# Ensure notes directory exists\nmkdir -p \"${NOTES_DIR}\"\necho \"[1/5] Notes directory ready: ${NOTES_DIR}\"\n\n# Configure Tomcat port to 5000 (Replit requirement)\necho \"[2/5] Configuring Tomcat to use port 5000...\"\nsed -i 's/port=\"8080\"/port=\"5000\"/g' \"${TOMCAT_HOME}/conf/server.xml\"\nsed -i 's/redirectPort=\"8443\"/redirectPort=\"5443\"/g' \"${TOMCAT_HOME}/conf/server.xml\"\n\n# Copy tomcat-users.xml for authentication\necho \"[3/5] Setting up authentication...\"\ncp \"${PROJECT_DIR}/conf/tomcat-users.xml\" \"${TOMCAT_HOME}/conf/tomcat-users.xml\"\n\n# Build the application with Maven\necho \"[4/5] Building application with Maven...\"\ncd \"${PROJECT_DIR}\"\nmvn clean package -q -DskipTests\n\n# Deploy the WAR file\necho \"[5/5] Deploying to Tomcat...\"\nrm -rf \"${TOMCAT_HOME}/webapps/ROOT\"\nrm -f \"${TOMCAT_HOME}/webapps/ROOT.war\"\ncp target/notes.war \"${TOMCAT_HOME}/webapps/ROOT.war\"\n\necho \"==============================================\"\necho \"  Application deployed successfully!\"\necho \"  Starting Tomcat server...\"\necho \"==============================================\"\necho \"\"\necho \"  Public page: http://0.0.0.0:5000/\"\necho \"  Admin page:  http://0.0.0.0:5000/admin/dashboard\"\necho \"  Admin login: admin / admin123\"\necho \"\"\necho \"==============================================\"\n\n# Start Tomcat in foreground\nexport CATALINA_HOME=\"${TOMCAT_HOME}\"\nexport CATALINA_BASE=\"${TOMCAT_HOME}\"\nexec \"${TOMCAT_HOME}/bin/catalina.sh\" run\n","path":null,"size_bytes":1981,"size_tokens":null},"src/main/java/com/notes/servlets/DownloadServlet.java":{"content":"package com.notes.servlets;\n\nimport java.io.File;\nimport java.io.FileInputStream;\nimport java.io.IOException;\nimport java.io.OutputStream;\nimport java.net.URLEncoder;\nimport java.nio.file.Files;\nimport javax.servlet.ServletException;\nimport javax.servlet.annotation.WebServlet;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\n\n/**\n * DownloadServlet - Handles file downloads for public users.\n * \n * This servlet serves note files for download.\n * No authentication required - anyone can download notes.\n * \n * @author Admin\n */\n@WebServlet(\"/download\")\npublic class DownloadServlet extends HttpServlet {\n    \n    // Directory where notes are stored\n    private static final String NOTES_DIR = System.getProperty(\"user.dir\") + \"/notes\";\n    \n    @Override\n    protected void doGet(HttpServletRequest request, HttpServletResponse response) \n            throws ServletException, IOException {\n        \n        // Get the filename from the request parameter\n        String fileName = request.getParameter(\"file\");\n        \n        if (fileName == null || fileName.trim().isEmpty()) {\n            response.sendError(HttpServletResponse.SC_BAD_REQUEST, \"No file specified\");\n            return;\n        }\n        \n        // Sanitize the filename to prevent directory traversal attacks\n        fileName = sanitizeFileName(fileName);\n        \n        // Create the file path\n        File file = new File(NOTES_DIR, fileName);\n        \n        // Security check: ensure the file is within the notes directory\n        if (!file.getCanonicalPath().startsWith(new File(NOTES_DIR).getCanonicalPath())) {\n            response.sendError(HttpServletResponse.SC_FORBIDDEN, \"Access denied\");\n            return;\n        }\n        \n        // Check if file exists\n        if (!file.exists() || !file.isFile()) {\n            response.sendError(HttpServletResponse.SC_NOT_FOUND, \"File not found\");\n            return;\n        }\n        \n        // Determine the content type based on file extension\n        String contentType = getServletContext().getMimeType(fileName);\n        if (contentType == null) {\n            contentType = \"application/octet-stream\";\n        }\n        \n        // Set response headers for file download\n        response.setContentType(contentType);\n        response.setContentLength((int) file.length());\n        \n        // Set Content-Disposition header to prompt download with original filename\n        String encodedFileName = URLEncoder.encode(fileName, \"UTF-8\").replace(\"+\", \"%20\");\n        response.setHeader(\"Content-Disposition\", \n            \"attachment; filename=\\\"\" + fileName + \"\\\"; filename*=UTF-8''\" + encodedFileName);\n        \n        // Stream the file to the response\n        try (FileInputStream fis = new FileInputStream(file);\n             OutputStream os = response.getOutputStream()) {\n            \n            byte[] buffer = new byte[4096];\n            int bytesRead;\n            \n            while ((bytesRead = fis.read(buffer)) != -1) {\n                os.write(buffer, 0, bytesRead);\n            }\n        }\n    }\n    \n    /**\n     * Sanitizes the filename to prevent security issues.\n     * Removes potentially dangerous characters and path components.\n     * \n     * @param fileName The original filename\n     * @return A sanitized, safe filename\n     */\n    private String sanitizeFileName(String fileName) {\n        // Remove any path separators to prevent directory traversal\n        fileName = fileName.replaceAll(\"[/\\\\\\\\]\", \"\");\n        // Remove any null bytes\n        fileName = fileName.replace(\"\\0\", \"\");\n        return fileName;\n    }\n}\n","path":null,"size_bytes":3670,"size_tokens":null},"replit.md":{"content":"# Student Notes Sharing Application\n\n## Overview\nA beginner-friendly Java web application using Servlets and JSP for student notes sharing. Students can download notes publicly, while only the admin can upload or delete files. Uses Apache Tomcat as the web server with BASIC authentication for admin access.\n\n## Project Structure\n```\nstudent-notes/\n├── src/main/\n│   ├── java/com/notes/servlets/\n│   │   ├── ListNotesServlet.java      # Lists files for public page\n│   │   ├── DownloadServlet.java       # Handles file downloads\n│   │   ├── AdminDashboardServlet.java # Admin dashboard\n│   │   ├── UploadServlet.java         # Handles file uploads\n│   │   └── DeleteServlet.java         # Handles file deletion\n│   └── webapp/\n│       ├── index.jsp                  # Public notes listing page\n│       └── WEB-INF/\n│           ├── admin.jsp              # Admin dashboard page\n│           └── web.xml                # Security configuration\n├── conf/\n│   └── tomcat-users.xml               # Admin user configuration\n├── notes/                             # Uploaded files directory\n├── pom.xml                            # Maven configuration\n├── run.sh                             # Build and run script\n└── replit.md                          # This documentation\n```\n\n## Technology Stack\n- **Java 11+** - Programming language\n- **Servlets 4.0** - Server-side logic\n- **JSP** - View templates\n- **Apache Tomcat 9** - Web server/servlet container\n- **Maven** - Build tool\n- No frameworks (Spring, Hibernate, etc.)\n\n## Features\n\n### Public Features (No Login Required)\n- View list of all available notes at `/` or `/list`\n- Download any note file by clicking on it\n\n### Admin Features (Login Required)\n- Access admin dashboard at `/admin/dashboard`\n- Upload new note files\n- Delete existing note files\n- Protected by HTTP BASIC authentication\n\n## Authentication\n- **Username:** admin\n- **Password:** admin123\n- Configured in `conf/tomcat-users.xml`\n- Security constraints defined in `src/main/webapp/WEB-INF/web.xml`\n\n## How to Run\nThe application runs automatically using the configured workflow:\n1. Maven builds the WAR file\n2. WAR is deployed to Tomcat's webapps directory\n3. Tomcat starts on port 5000\n\n## File Storage\nUploaded files are stored in the `notes/` directory at the project root (outside the WAR file). This ensures files persist across redeployments.\n\n## URLs\n- **Public Page:** `http://hostname:5000/`\n- **Admin Dashboard:** `http://hostname:5000/admin/dashboard`\n\n## Security Notes\n- Admin endpoints (`/admin/*`) require authentication\n- BASIC authentication is configured via web.xml\n- File paths are sanitized to prevent directory traversal attacks\n- Hidden files (starting with `.`) are excluded from listings\n","path":null,"size_bytes":2874,"size_tokens":null},"src/main/java/com/notes/servlets/AdminDashboardServlet.java":{"content":"package com.notes.servlets;\n\nimport java.io.File;\nimport java.io.IOException;\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.List;\nimport javax.servlet.ServletException;\nimport javax.servlet.annotation.WebServlet;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\n\n/**\n * AdminDashboardServlet - Displays the admin dashboard with file management.\n * \n * This servlet lists all files and provides the admin interface\n * for uploading and deleting files.\n * Only accessible by authenticated admin users.\n * \n * @author Admin\n */\n@WebServlet(\"/admin/dashboard\")\npublic class AdminDashboardServlet extends HttpServlet {\n    \n    // Directory where notes are stored\n    private static final String NOTES_DIR = System.getProperty(\"user.dir\") + \"/notes\";\n    \n    @Override\n    protected void doGet(HttpServletRequest request, HttpServletResponse response) \n            throws ServletException, IOException {\n        \n        loadFilesAndForward(request, response);\n    }\n    \n    @Override\n    protected void doPost(HttpServletRequest request, HttpServletResponse response) \n            throws ServletException, IOException {\n        \n        loadFilesAndForward(request, response);\n    }\n    \n    /**\n     * Loads the list of files and forwards to the admin JSP.\n     */\n    private void loadFilesAndForward(HttpServletRequest request, HttpServletResponse response) \n            throws ServletException, IOException {\n        \n        // Create the notes directory if it doesn't exist\n        File notesFolder = new File(NOTES_DIR);\n        if (!notesFolder.exists()) {\n            notesFolder.mkdirs();\n        }\n        \n        // Get list of all files in the notes directory\n        List<FileInfo> noteFiles = new ArrayList<>();\n        File[] files = notesFolder.listFiles();\n        \n        if (files != null) {\n            // Sort files by name for consistent display\n            Arrays.sort(files, (f1, f2) -> f1.getName().compareToIgnoreCase(f2.getName()));\n            \n            for (File file : files) {\n                // Only include regular files, not directories or hidden files\n                if (file.isFile() && !file.getName().startsWith(\".\")) {\n                    noteFiles.add(new FileInfo(\n                        file.getName(),\n                        formatFileSize(file.length()),\n                        file.lastModified()\n                    ));\n                }\n            }\n        }\n        \n        // Store the file list in request attribute for JSP to access\n        request.setAttribute(\"noteFiles\", noteFiles);\n        request.setAttribute(\"notesDir\", NOTES_DIR);\n        \n        // Get the logged-in admin username\n        String adminUser = request.getRemoteUser();\n        request.setAttribute(\"adminUser\", adminUser != null ? adminUser : \"Admin\");\n        \n        // Forward to admin.jsp for display\n        request.getRequestDispatcher(\"/WEB-INF/admin.jsp\").forward(request, response);\n    }\n    \n    /**\n     * Formats file size into human-readable format.\n     * \n     * @param size File size in bytes\n     * @return Formatted size string (e.g., \"1.5 MB\")\n     */\n    private String formatFileSize(long size) {\n        if (size < 1024) {\n            return size + \" B\";\n        } else if (size < 1024 * 1024) {\n            return String.format(\"%.1f KB\", size / 1024.0);\n        } else if (size < 1024 * 1024 * 1024) {\n            return String.format(\"%.1f MB\", size / (1024.0 * 1024));\n        } else {\n            return String.format(\"%.1f GB\", size / (1024.0 * 1024 * 1024));\n        }\n    }\n    \n    /**\n     * Simple class to hold file information for display.\n     */\n    public static class FileInfo {\n        private String name;\n        private String size;\n        private long lastModified;\n        \n        public FileInfo(String name, String size, long lastModified) {\n            this.name = name;\n            this.size = size;\n            this.lastModified = lastModified;\n        }\n        \n        public String getName() { return name; }\n        public String getSize() { return size; }\n        public long getLastModified() { return lastModified; }\n    }\n}\n","path":null,"size_bytes":4232,"size_tokens":null}},"version":2}